/* Automatically generated file. Do not edit directly.
Copyright (C) 2019 Gab AI, Inc.
All Rights Reserved */
var BROWSER_CONFIG={name:"Google Chrome",slug:"chrome",version:"0.1.5"},BROWSER_CHROME_SLUG="chrome",BROWSER_FIREFOX_SLUG="firefox",BROWSER_EDGE_SLUG="edge",BROWSER_SAFARI_SLUG="safari",BASE_URI="https://dissenter.com/discussion/begin-extension?url=",COMMENT_COUNT_URI="https://dissenter.com/notification/comment-count?url=",BACKGROUND_ACTION_OPEN_POPUP="open_popup",BACKGROUND_ACTION_GET_KEY="get_key",BACKGROUND_ACTION_SET_KEY="set_key",BACKGROUND_ACTION_SET_BADGE="set_badge",BACKGROUND_ACTION_TAB_UPDATED="tab_updated",COLOR_GAB_GREEN="#21cf7b",STORAGE_BASE="gab_dissenter_extension_data",TWITTER_BUTTONS_ENABLED="twitter_buttons_enabled",REDDIT_BUTTONS_ENABLED="reddit_buttons_enabled",YOUTUBE_BUTTONS_ENABLED="youtube_buttons_enabled",WINDOW_SIDEBAR_UNAVAILABLE_ENABLED="window_sidebar_unavailable_enabled",WEBSITE_COMMENT_BADGE_ENABLED="website_comment_badge_enabled",DISSENT_DISQUS_BUTTONS_ENABLED="dissent_disqus_buttons_enabled",STORAGE_DEFAULT_PARAMS={};STORAGE_DEFAULT_PARAMS[TWITTER_BUTTONS_ENABLED]=!0,STORAGE_DEFAULT_PARAMS[REDDIT_BUTTONS_ENABLED]=!0,STORAGE_DEFAULT_PARAMS[YOUTUBE_BUTTONS_ENABLED]=!0,STORAGE_DEFAULT_PARAMS[WINDOW_SIDEBAR_UNAVAILABLE_ENABLED]=!0,STORAGE_DEFAULT_PARAMS[WEBSITE_COMMENT_BADGE_ENABLED]=!0,STORAGE_DEFAULT_PARAMS[DISSENT_DISQUS_BUTTONS_ENABLED]=!0;var STORAGE_KEY_ALL="all",isObject=function(e){return!isArray(e)&&!isDate(e)&&(null!==e&&"object"==typeof e)},isString=function(e){return"string"==typeof e||e instanceof String},isDate=function(e){return!isString(e)&&!isArray(e)&&null!=e&&null!=e&&(e&&"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e))},isArray=function(e){return Array.isArray(e)};function ready(e){var t=document;"loading"==t.readyState?t.addEventListener("DOMContentLoaded",e):e()}function getQueryStringValue(e){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}function setExtensionIconBadge(e){e||(e=""),e=formatBadgeText(e=String(e)),chrome.browserAction.setBadgeBackgroundColor({color:"#f40e1c"}),chrome.browserAction.setBadgeText({text:e}),BROWSER_CONFIG.slug===BROWSER_FIREFOX_SLUG&&chrome.browserAction.setBadgeTextColor({color:"#ffffff"})}function formatBadgeText(e){if(!e)return"";var t=parseInt(e);if(t<1)return"";var n="";if(t<1e3)return String(t);if(1e3<=t&&t<1e4){var r=truncateNumber(t,2);n=(r/=10)+"k"}else if(1e4<=t&&t<1e5){n=(r=truncateNumber(t,2))+"k"}else if(1e5<=t&&t<1e6){n=(r=truncateNumber(t,3))+"k"}else 1e6<=t&&(n="1M+");return n}function truncateNumber(e,t){return e?e.toString().substring(0,t):0}function performRequest(e,t){if(!e||!isObject(e))return t(!1,{});var n=e.method||"",r=e.url||"",o=e.params,i=e.headers;if(!n||!r)return!!t&&t(!1,{});var a=new XMLHttpRequest;if(a.open(n,r,!0),a.setRequestHeader("Content-type","application/json"),i&&isArray(i))for(var _=0;_<i.length;_++){var s=i[_];isObject(s)&&a.setRequestHeader(s.key,s.value)}o&&isObject(o)?a.send(JSON.stringify(o)):a.send({}),a.onload=function(){var e={};try{e=JSON.parse(a.responseText)}catch(e){}t&&t(!1,e)},a.onerror=function(){var e={};try{e=JSON.parse(a.responseText)}catch(e){}t&&t(!0,e)}}function GDEStorage(){var n=this;n.init=function(){return function(){if(null==window.localStorage)return;window.localStorage[STORAGE_BASE]||isObject(window.localStorage[STORAGE_BASE])||(window.localStorage[STORAGE_BASE]=JSON.stringify(STORAGE_DEFAULT_PARAMS));var e=window.localStorage[STORAGE_BASE];for(var t in e=JSON.parse(e),STORAGE_DEFAULT_PARAMS)void 0===e[t]&&n.setValue(t,STORAGE_DEFAULT_PARAMS[t])}(),!0},n.getValue=function(e){if(null==window.localStorage&&isObject(window.localStorage))return!1;var t=window.localStorage[STORAGE_BASE];return t=JSON.parse(t),e===STORAGE_KEY_ALL?t:t[e]},n.setValue=function(e,t){if(null==window.localStorage&&isObject(window.localStorage))return!1;var n=window.localStorage[STORAGE_BASE];return(n=JSON.parse(n))[e]=t,window.localStorage[STORAGE_BASE]=JSON.stringify(n),!0}}chrome.browserAction.onClicked.addListener(function(){chrome.tabs.create({url:"index.html"})}),chrome.tabs.onUpdated.addListener(function(e){setExtensionIconBadge(""),chrome.tabs.sendMessage(e,{action:BACKGROUND_ACTION_TAB_UPDATED})}),chrome.tabs.onActivated.addListener(function(e){setExtensionIconBadge(""),chrome.tabs.sendMessage(e.tabId,{action:BACKGROUND_ACTION_TAB_UPDATED})}),chrome.runtime.onMessage.addListener(function(e,t,n){var r=e.action||"";if(r===BACKGROUND_ACTION_OPEN_POPUP){var o=e.url||"",i=e.height||0,a=screen.width,_=screen.height-i,s=chrome.extension.getURL("popup/popup.html?url="+o),E=gdes.getValue(WINDOW_SIDEBAR_UNAVAILABLE_ENABLED);if(BROWSER_CONFIG.slug===BROWSER_FIREFOX_SLUG&&!E)return chrome.runtime.sendMessage({url:o}),!0;chrome.windows.create({url:s,width:420,height:i,top:_,left:a,type:"popup"})}else if(r===BACKGROUND_ACTION_GET_KEY){if(!(c=e.key||""))return n&&n(null),!0;var A=gdes.getValue(c);n&&n(A)}else if(r===BACKGROUND_ACTION_SET_KEY){var c=e.key||"";A=e.value;if(!c)return!0;gdes.setValue(c,A),c!==WEBSITE_COMMENT_BADGE_ENABLED||A||setExtensionIconBadge("")}else if(r===BACKGROUND_ACTION_SET_BADGE){if(!(o=e.url||"")||!isString(o))return setExtensionIconBadge(""),!0;performRequest({method:"GET",url:COMMENT_COUNT_URI+encodeURIComponent(o)},function(e,t){return isObject(t)&&t.success?void setExtensionIconBadge(String(t.url.stats.commentCount)):(setExtensionIconBadge(""),!0)})}return!0});var gdes=new GDEStorage;gdes.init();